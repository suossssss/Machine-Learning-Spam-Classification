 followup to emailaddr pleas unless you re specif concern about some particular bit of email polici for python org ok after much fiddl with and tweak of etc exim eximnumb conf and etc exim local scan py on mail python org i am fairli confid that i can start harvest all incom email at a moment s notic for the record here s how it all work eximnumb conf work almost exactli the same as befor if the file etc exim harvest doe not exist that is ani junk mail condit that can be detect by exim acl access control list is handl entir in eximnumb conf the messag is reject befor it ever get to local scan py thi cover such divers case as messag from known spammer reject after everi rcpt to command no messag id header and number bit char in subject both reject after the messag header bodi ar read the main thing i have chang in the absenc of etc exim harvest ar don t check for number bit char in from header the vast major of hit for thi test were bounc from some asian isp the remain hit should be handl by spamassassin do header sender verif ie ensur that there s a verifi email address in at least on of from repli to and sender as late as possibl becaus it requir dn lookup which can be slow and can also make messag that should have been reject mere be defer if those dn lookup timeout if etc exim harvest exist then the behaviour of all of those acl in eximnumb conf suddenli chang instead of reject recipi or messag thei add an x reject header to the messag thi header is pure for intern us it record the name of the folder to which the reject messag should be save and also give the smtp error messag which should ultim be us to reject the messag thu those messag will now be seen by local scan py which now look for the x reject header if found it us the folder name specifi there to save the messag and then reject it with the smtp error messag also given in x reject current x reject is retain in save messag if a messag wa not tag with x reject then local scan py run the usual viru and spam check name my homebrew scan for attach with filenam that look like window execut and a run through spamassassin the logic is basic thi if viru folder viru els run through spamassassin if score number number folder reject spam elif score number number folder caught spam final local scan py write the messag to the design folder by far the biggest folder will be accept the server handl number number incom messag per dai of which mayb number number ar junk mail oop just realiz i haven t written the code that actual save the messag d ohh also haven t written anyth to discrimin person email which i must do sigh final the big catch wait until after you ve read the messag header and bodi to actual reject the messag is problemat becaus certain broken mta includ those us by some spammer don t consid a numberxx after data as a perman error but keep retri d ohh thi is a minor annoy current where a fair amount of stuff is reject at rcpt to time but in harvest mode everyth with the except of peopl probe for open relai will be reject at data time so i have cook up someth call the asbl or autom sender blacklist thi is just a berkelei db file that map sender ip sender address to an expiri time when local scan reject a messag from sender ip sender address for whatev reason includ find an x reject header ad by an acl in eximnumb conf it add a record to the asbl with an expiri time number hour in the futur meanwhil there s an acl in eximnumb conf that check for record in the asbl if there s a record for the current sender ip sender address that hasn t expir yet we reject all recipi without ever look at the messag header or bodi the downsid of thi from the point of view of corpu collect is that if some jerk is busili spam emailaddr on smtp connect per address we will most like onli get on copi thi is a win if you re just think about reduc server load and bandwidth but i m not sure if it s help for train spam detector tim happi harvest greg greg ward httpaddr budget s in the red let s tax religion dead kennedi
